"use strict";(self.webpackChunkimpact_zone_frontend=self.webpackChunkimpact_zone_frontend||[]).push([[895],{3895:(e,a,t)=>{t.r(a),t.d(a,{default:()=>D});var l=t(9379),n=t(5043),s=t(3191),i=t(7374),o=t(5050),d=t(3549),c=t(1688),u=t(9456),r=t(6038),v=t(7994),m=t(9106),p=t(962),f=t(346),y=t(639),h=t(1878),x=t(5711),A=t(6178),C=t.n(A),g=t(579);const D=()=>{var e,a,t,A,D,j,T;const w=(0,u.wA)(),{id:M}=(0,c.g)(),{employees:N,employeePayType:P}=(0,u.d4)((e=>e.settings.employee)),[E,b]=(0,n.useState)({event:"",classMeet:"ONE_TIME",classLocation:"",startDate:new Date,endDate:"",schedule:[{days:[],startTime:"",duration:"",endTime:""}],instructor:[{assistant:null,assistantPay:""}],staff:null,payType:"",totalCapacity:null,waitlistPeople:null,clientSignupClass:!1,onlineCapacity:null,clientPaylater:!1,clientClassFree:!1,isActive:!0});(0,n.useEffect)((()=>{w((0,y.Vs)()),w((0,m.kQ)()),w((0,x.Oc)())}),[w]);const{locationDropdown:Y}=(0,u.d4)((e=>e.settings.schedule)),{eventClassesDropDown:_}=(0,u.d4)((e=>e.settings.schedule));let{eventClasses:O}=(0,u.d4)((e=>e.settings.schedule));O=null===(e=O)||void 0===e?void 0:e.find((e=>e._id===(null===E||void 0===E?void 0:E.event)));const I=(0,c.W6)(),S=null===(a=O)||void 0===a||null===(t=a.duration)||void 0===t?void 0:t.map((e=>({name:"".concat(e," minutes"),value:e})));(0,n.useEffect)((()=>{null!==E&&void 0!==E&&E.event&&b((e=>{var a,t;return(0,l.A)((0,l.A)({},e),{},{totalCapacity:null===(a=O)||void 0===a?void 0:a.defaultMaxAttendes,waitlistPeople:null===(t=O)||void 0===t?void 0:t.maximumWaitlist})}))}),[null===E||void 0===E?void 0:E.event,O]),(0,n.useEffect)((()=>{M&&w((0,h.h5)(M,(e=>{var a,t,n;if(null!==e&&void 0!==e&&e.staff&&w((0,x.Zh)(null===e||void 0===e?void 0:e.staff)),b({event:e.event,classMeet:e.classMeet,classLocation:e.classLocation,startDate:new Date(e.startDate),endDate:new Date(e.endDate),schedule:null===(a=e.schedule)||void 0===a?void 0:a.map((e=>(0,l.A)((0,l.A)({},e),{},{startTime:(0,p.yQ)(e.startTime),endTime:e.endTime?(0,p.yQ)(e.endTime):null}))),instructor:e.instructor,staff:e.staff?null===e||void 0===e?void 0:e.staff:null,payType:e.pay,totalCapacity:e.totalCapacity?e.totalCapacity:null===(t=O)||void 0===t?void 0:t.defaultMaxAttendes,waitlistPeople:e.waitlistPeople?e.waitlistPeople:null===(n=O)||void 0===n?void 0:n.maximumWaitlist,clientSignupClass:e.clientSignupClass,onlineCapacity:e.onlineCapacity,clientPaylater:e.clientPaylater,clientClassFree:e.clientClassFree,isActive:e.isActive}),e.instructor&&e.instructor.length>0)for(const l of e.instructor)k(l.assistant)})))}),[M,w,N]);const k=async e=>{const a=N.find((a=>a._id===e));if(a){var t;const n=a.employeeClassData.map((e=>({name:e.label,value:e.payType}))).filter(((e,a,t)=>a===t.findIndex((a=>a.value===e.value)))),s=null===a||void 0===a||null===(t=a.employeeClassData)||void 0===t?void 0:t.find((e=>e.isDefaultPay));b((a=>(0,l.A)((0,l.A)({},a),{},{instructor:a.instructor.map((a=>a.assistant===e?(0,l.A)((0,l.A)({},a),{},{assistantPayOptions:n,assistantPay:s?s.payType:a.assistantPay}):a))})))}},B=(0,u.d4)((e=>{var a;return null===e||void 0===e||null===(a=e.loader)||void 0===a?void 0:a.isLoading})),R=e=>{let{name:a,value:t}=e;if("classMeet"===a)b((e=>{const a=e.schedule.map((e=>"ONE_TIME"===t?(0,l.A)((0,l.A)({},e),{},{days:[]}):e));return(0,l.A)((0,l.A)({},e),{},{classMeet:t,schedule:a})}));else{const e=(0,r.A)(a,t,E);b((n=>(0,l.A)((0,l.A)({},n),{},{[a]:t,formErrors:e})))}};(0,n.useEffect)((()=>{"ONE_TIME"===(null===E||void 0===E?void 0:E.classMeet)&&b((e=>(0,l.A)((0,l.A)({},e),{},{endDate:null===E||void 0===E?void 0:E.startDate})))}),[null===E||void 0===E?void 0:E.classMeet,null===E||void 0===E?void 0:E.startDate]),(0,n.useEffect)((()=>{null!==E&&void 0!==E&&E.event&&(w((0,m.gw)(null===E||void 0===E?void 0:E.event)),b((e=>(0,l.A)((0,l.A)({},e),{},{payType:"",instructor:[{assistant:null,assistantPay:""}]}))))}),[null===E||void 0===E?void 0:E.event]);const{servicesEvents:F}=(0,u.d4)((e=>e.settings.schedule)),L=F&&(null===F||void 0===F||null===(A=F.EventService)||void 0===A?void 0:A.map((e=>{var a;return null===(a=e.eventLevel)||void 0===a?void 0:a._id}))),Z=null===(D=N.filter((e=>e.isClassLevel.some((e=>null===L||void 0===L?void 0:L.includes(e))))))||void 0===D?void 0:D.map((e=>({name:e.firstName,value:e._id})));(0,n.useEffect)((()=>(null!==E&&void 0!==E&&E.staff&&w((0,x.Zh)(null===E||void 0===E?void 0:E.staff)),()=>{w({type:f.g.CHANGE_EMPLOYEES_PAY_TYPE,payload:[]})})),[null===E||void 0===E?void 0:E.staff,w]),(0,n.useEffect)((()=>{if(P){var e;let a=null===P||void 0===P||null===(e=P.employeeClassData)||void 0===e?void 0:e.find((e=>e.isDefaultPay));b((e=>(0,l.A)((0,l.A)({},e),{},{payType:a?a.payType:null})))}}),[P,N]);const W=async e=>{let{name:a,value:t,customIndex:n,fieldName:s}=e;const i=(0,l.A)({},E);let o=i[s][n];if(o[a]=t,"assistant"===a&&(i[s][n]=o,b((()=>(0,l.A)({},i))),await w((0,x.Zh)(t))),"duration"===a){const e=null===o||void 0===o?void 0:o.startTime;if(e&&t){const a=new Date(C()(e).add(t,"minutes"));o.endTime=a,o.duration=t}else o.endTime=null,o.duration=null}if("startTime"===a){const e=t,a=null===o||void 0===o?void 0:o.duration;if(e&&a){const t=new Date(C()(e).add(a,"minutes"));o.startTime=e,o.endTime=t}else e&&!a?(o.startTime=e,o.endTime=null,o.duration=null):(o.endTime=null,o.duration=null)}const d=(0,r.A)(a,t,o);if(o.formErrors=d,i[s][n]=o,b((()=>(0,l.A)({},i))),"assistant"===a){const e=t,a=N.find((a=>a._id===e));if(a){var c;const e=a.employeeClassData.map((e=>({name:e.label,value:e.payType}))).filter(((e,a,t)=>a===t.findIndex((a=>a.value===e.value)))),t=null===a||void 0===a||null===(c=a.employeeClassData)||void 0===c?void 0:c.find((e=>e.isDefaultPay));b((a=>(0,l.A)((0,l.A)({},a),{},{instructor:a.instructor.map(((a,s)=>s===n?(0,l.A)((0,l.A)({},a),{},{assistantPayOptions:e,assistantPay:t?t.payType:null}):a))})))}}},V=e=>{var a;const t=null===(a=E.instructor.filter(((a,t)=>t!==e)))||void 0===a?void 0:a.flatMap((e=>e.assistant)),l=[E.staff,...t];return Z.filter((e=>!l.includes(e.value)))},z=(e,a)=>{b((t=>(0,l.A)((0,l.A)({},t),{},{[a]:t[a].filter(((a,t)=>t!==e))})))};return console.log(E,"data"),(0,g.jsx)(g.Fragment,{children:(0,g.jsxs)(o.A,{backText:"Classes",children:[(0,g.jsxs)(d.Ay,{title:"When and Where",col:"12",children:[(0,g.jsxs)(d.a,{children:[(0,g.jsx)(s.BR,{name:"event",label:"Class Name",options:_,onChange:R,data:E,col:4}),(0,g.jsx)(s.BR,{name:"classMeet",label:"How often does class meet?",options:i.e6,onChange:R,data:E}),(0,g.jsx)(s.BR,{name:"classLocation",options:Y,onChange:R,data:E}),(0,g.jsx)(s.wN,{name:"startDate",onChange:R,data:E,minDate:new Date}),(0,g.jsx)(s.wN,{name:"endDate",onChange:R,data:E,disabled:!(null!==E&&void 0!==E&&E.startDate)||"ONE_TIME"===(null===E||void 0===E?void 0:E.classMeet)}),(0,g.jsx)(s.o4,{name:"isActive",data:E,onChange:R,extraClassName:"text-right",col:4})]}),(0,g.jsx)(d.a,{extraClass:"justify-content-end",children:(0,g.jsx)(v.Ay,{label:"Add New Schedule",className:"mx-2 ",onClick:()=>{const e={days:[],startTime:"",timeFormat:"",duration:"",endTime:""};b((a=>(0,l.A)((0,l.A)({},a),{},{schedule:[...a.schedule,e]})))},loading:B})}),null===E||void 0===E||null===(j=E.schedule)||void 0===j?void 0:j.map(((e,a)=>(0,g.jsx)("div",{children:(0,g.jsxs)(d.a,{extraClass:"align-items-center",children:[(0,g.jsx)(s.wN,{name:"startTime",customIndex:a,onChange:W,data:e,fieldName:"schedule",timeOnly:!0,placeholder:"Select Time",hourFormat:"12"}),(0,g.jsx)(s.BR,{name:"duration",customIndex:a,options:S,onChange:W,data:e,fieldName:"schedule"}),"ONE_TIME"!==(null===E||void 0===E?void 0:E.classMeet)&&(0,g.jsx)(s.Rx,{name:"days",customIndex:a,onChange:W,data:e,options:i.dl,fieldName:"schedule",col:4}),(0,g.jsx)(s.wN,{name:"endTime",customIndex:a,onChange:W,data:e,fieldName:"schedule",timeOnly:!0,placeholder:"Select Time",hourFormat:"12",disabled:!0}),a>0&&(0,g.jsx)("i",{className:"pi pi-minus-circle mt-4",onClick:()=>z(a,"schedule")})]})},a)))]}),(0,g.jsxs)(d.Ay,{title:"Instructor",col:"12",children:[(0,g.jsxs)(d.a,{children:[(0,g.jsx)(s.BR,{name:"staff",options:Z,onChange:R,data:E}),(0,g.jsx)(s.BR,{name:"payType",options:(()=>{var e,a;let t=null===P||void 0===P||null===(e=P.employeeClassData)||void 0===e?void 0:e.map((e=>({name:e.label,value:e.payType})));const l=new Set(null===t||void 0===t?void 0:t.map((e=>JSON.stringify(e))));return null===(a=Array.from(l))||void 0===a?void 0:a.map((e=>JSON.parse(e)))})(),onChange:R,data:E})]}),(0,g.jsx)(d.a,{extraClass:"justify-content-end",children:(0,g.jsx)(v.Ay,{label:"Add Assistant",className:"mx-2",onClick:()=>{const e={assistant:"",assistantPay:""};b((a=>(0,l.A)((0,l.A)({},a),{},{instructor:[...a.instructor,e]})))},loading:B})}),null===E||void 0===E||null===(T=E.instructor)||void 0===T?void 0:T.map(((e,a)=>(0,g.jsx)("div",{children:(0,g.jsxs)(d.a,{extraClass:"align-items-center",children:[(0,g.jsx)(s.BR,{name:"assistant",customIndex:a,options:V(a),fieldName:"instructor",onChange:W,data:e}),(0,g.jsx)(s.BR,{name:"assistantPay",customIndex:a,options:e.assistantPayOptions,fieldName:"instructor",onChange:W,data:e}),a>0&&(0,g.jsx)("i",{className:"pi pi-minus-circle mt-4",onClick:()=>z(a,"instructor")})]})},a)))]}),(0,g.jsx)(d.Ay,{title:"Participants",col:"12",children:(0,g.jsxs)(d.a,{children:[(0,g.jsx)(s.Bt,{name:"totalCapacity",onChange:R,data:E}),(0,g.jsx)(s.Bt,{name:"waitlistPeople",label:"How many people can waitlist",onChange:R,data:E})]})}),(0,g.jsx)(d.Ay,{title:"Online Scheduling",col:"12",children:(0,g.jsxs)(d.a,{children:[(0,g.jsx)(s.ZD,{name:"clientSignupClass",label:"Allow clients to sign up for this class online",onChange:R,data:E,col:"12"}),(0,g.jsx)(s.Bt,{name:"onlineCapacity",label:"Online Capacity",onChange:R,data:E,col:"6"})]})}),(0,g.jsx)(d.Ay,{title:"Pricing",col:"12",children:(0,g.jsxs)(d.a,{children:[(0,g.jsx)(s.ZD,{name:"clientPaylater",label:"Allow clients to sign up now and pay later",onChange:R,data:E,col:"12"}),(0,g.jsx)(s.ZD,{name:"clientClassFree",label:"Clients can attend this class for free",onChange:R,data:E,col:"12"})]})}),(0,g.jsxs)(v.zp,{children:[(0,g.jsx)(v.Ay,{label:"Save",className:"mx-2",onClick:()=>{if((0,p.nV)(E,b)){let e=(0,p.Kk)(E.schedule,"ONE_TIME"===(null===E||void 0===E?void 0:E.classMeet)?["days"]:[]);console.log(e,"validatedSchedule"),e.isValid||b((a=>(0,l.A)((0,l.A)({},a),{},{schedule:e.data}))),e.isValid&&w(M?(0,h.fA)(M,(0,l.A)((0,l.A)({},E),{},{startDate:C()(E.startDate).format("YYYY-MM-DD"),endDate:C()(E.endDate).format("YYYY-MM-DD")}),I):(0,h.gR)((0,l.A)((0,l.A)({},E),{},{startDate:C()(E.startDate).format("YYYY-MM-DD"),endDate:C()(E.endDate).format("YYYY-MM-DD")}),I))}},loading:B}),(0,g.jsx)(v.Ti,{label:"Cancel",onClick:()=>I.goBack()})]})]})})}}}]);
//# sourceMappingURL=895.901af0fe.chunk.js.map