"use strict";(self.webpackChunkimpact_zone_frontend=self.webpackChunkimpact_zone_frontend||[]).push([[895],{3895:(e,a,t)=>{t.r(a),t.d(a,{default:()=>j});var l=t(5043),s=t(666),n=t(7374),i=t(5050),o=t(3549),d=t(1688),c=t(9456),u=t(6038),r=t(7994),v=t(9106),m=t(3335),p=t(346),f=t(639),y=t(1878),h=t(5711),C=t(6178),x=t.n(C),g=t(579);const j=()=>{var e,a,t,C,j,T,w;const D=(0,c.wA)(),{id:P}=(0,d.g)(),{employees:A,employeePayType:N}=(0,c.d4)((e=>e.settings.employee)),[b,E]=(0,l.useState)({event:"",classMeet:"",classLocation:"",startDate:"",endDate:"",schedule:[{days:[],startTime:"",duration:"",endTime:""}],instructor:[{assistant:null,assistantPay:""}],staff:null,payType:"",totalCapacity:null,waitlistPeople:null,clientSignupClass:!1,onlineCapacity:null,clientPaylater:!1,clientClassFree:!1,isActive:!0});(0,l.useEffect)((()=>{D((0,f.Vs)()),D((0,v.kQ)()),D((0,h.Oc)())}),[D]);const{locationDropdown:S}=(0,c.d4)((e=>e.settings.schedule)),{eventClassesDropDown:k}=(0,c.d4)((e=>e.settings.schedule));let{eventClasses:L}=(0,c.d4)((e=>e.settings.schedule));L=null===(e=L)||void 0===e?void 0:e.find((e=>e._id===(null===b||void 0===b?void 0:b.event)));const B=(0,d.W6)();console.log(L,"eventClasses");const _=null===(a=L)||void 0===a||null===(t=a.duration)||void 0===t?void 0:t.map((e=>({name:"".concat(e," minutes"),value:e})));console.log(_),(0,l.useEffect)((()=>{null!==b&&void 0!==b&&b.event&&E((e=>{var a,t;return{...e,totalCapacity:null===(a=L)||void 0===a?void 0:a.defaultMaxAttendes,waitlistPeople:null===(t=L)||void 0===t?void 0:t.maximumWaitlist}}))}),[null===b||void 0===b?void 0:b.event,L]),(0,l.useEffect)((()=>{P&&D((0,y.h5)(P,(e=>{var a,t,l;if(null!==e&&void 0!==e&&e.staff&&D((0,h.Zh)(null===e||void 0===e?void 0:e.staff)),E({event:e.event,classMeet:e.classMeet,classLocation:e.classLocation,startDate:new Date(e.startDate),endDate:new Date(e.endDate),schedule:null===(a=e.schedule)||void 0===a?void 0:a.map((e=>({...e,startTime:(0,m.yQ)(e.startTime),endTime:e.endTime?(0,m.yQ)(e.endTime):null}))),instructor:e.instructor,staff:e.staff?null===e||void 0===e?void 0:e.staff:null,payType:e.pay,totalCapacity:e.totalCapacity?e.totalCapacity:null===(t=L)||void 0===t?void 0:t.defaultMaxAttendes,waitlistPeople:e.waitlistPeople?e.waitlistPeople:null===(l=L)||void 0===l?void 0:l.maximumWaitlist,clientSignupClass:e.clientSignupClass,onlineCapacity:e.onlineCapacity,clientPaylater:e.clientPaylater,clientClassFree:e.clientClassFree,isActive:e.isActive}),e.instructor&&e.instructor.length>0)for(const s of e.instructor)O(s.assistant)})))}),[P,D,A]);const O=async e=>{const a=A.find((a=>a._id===e));if(a){var t;const l=a.employeeClassData.map((e=>({name:e.label,value:e.payType}))).filter(((e,a,t)=>a===t.findIndex((a=>a.value===e.value)))),s=null===a||void 0===a||null===(t=a.employeeClassData)||void 0===t?void 0:t.find((e=>e.isDefaultPay));E((a=>({...a,instructor:a.instructor.map((a=>a.assistant===e?{...a,assistantPayOptions:l,assistantPay:s?s.payType:a.assistantPay}:a))})))}},I=(0,c.d4)((e=>{var a;return null===e||void 0===e||null===(a=e.loader)||void 0===a?void 0:a.isLoading})),R=e=>{let{name:a,value:t}=e;const l=(0,u.A)(a,t,b);E((e=>({...e,[a]:t,formErrors:l})))};(0,l.useEffect)((()=>{null!==b&&void 0!==b&&b.event&&(D((0,v.gw)(null===b||void 0===b?void 0:b.event)),E((e=>({...e,payType:"",instructor:[{assistant:null,assistantPay:""}]}))))}),[null===b||void 0===b?void 0:b.event]);const{servicesEvents:F}=(0,c.d4)((e=>e.settings.schedule)),M=F&&(null===F||void 0===F||null===(C=F.EventService)||void 0===C?void 0:C.map((e=>{var a;return null===(a=e.eventLevel)||void 0===a?void 0:a._id}))),W=null===(j=A.filter((e=>(console.log(e,M,e.isClassLevel,"isClassLevel"),e.isClassLevel.some((e=>null===M||void 0===M?void 0:M.includes(e)))))))||void 0===j?void 0:j.map((e=>({name:e.firstName,value:e._id})));console.log(A.filter((e=>(console.log(e,M,e.isClassLevel,"isClassLevel"),e.isClassLevel.some((e=>null===M||void 0===M?void 0:M.includes(e)))))),"employeesWithLevel"),(0,l.useEffect)((()=>(null!==b&&void 0!==b&&b.staff&&D((0,h.Zh)(null===b||void 0===b?void 0:b.staff)),()=>{D({type:p.g.CHANGE_EMPLOYEES_PAY_TYPE,payload:[]})})),[null===b||void 0===b?void 0:b.staff,D]),(0,l.useEffect)((()=>{if(N){var e;let a=null===N||void 0===N||null===(e=N.employeeClassData)||void 0===e?void 0:e.find((e=>e.isDefaultPay));E((e=>({...e,payType:a?a.payType:null})))}}),[N,A]);const Z=async e=>{let{name:a,value:t,customIndex:l,fieldName:s}=e;const n={...b};let i=n[s][l];if(i[a]=t,"assistant"===a&&(n[s][l]=i,E((()=>({...n}))),await D((0,h.Zh)(t))),"duration"===a){const e=null===i||void 0===i?void 0:i.startTime;if(e&&t){const a=new Date(x()(e).add(t,"minutes"));i.endTime=a,i.duration=t}else i.endTime=null,i.duration=null}if("startTime"===a){const e=t,a=null===i||void 0===i?void 0:i.duration;if(e&&a){const t=new Date(x()(e).add(a,"minutes"));i.startTime=e,i.endTime=t}else e&&!a?(i.startTime=e,i.endTime=null,i.duration=null):(i.endTime=null,i.duration=null)}const o=(0,u.A)(a,t,i);if(i.formErrors=o,n[s][l]=i,E((()=>({...n}))),"assistant"===a){const e=t,a=A.find((a=>a._id===e));if(a){var d;const e=a.employeeClassData.map((e=>({name:e.label,value:e.payType}))).filter(((e,a,t)=>a===t.findIndex((a=>a.value===e.value)))),t=null===a||void 0===a||null===(d=a.employeeClassData)||void 0===d?void 0:d.find((e=>e.isDefaultPay));E((a=>({...a,instructor:a.instructor.map(((a,s)=>s===l?{...a,assistantPayOptions:e,assistantPay:t?t.payType:null}:a))})))}}},V=e=>{var a;const t=null===(a=b.instructor.filter(((a,t)=>t!==e)))||void 0===a?void 0:a.flatMap((e=>e.assistant)),l=[b.staff,...t];return W.filter((e=>!l.includes(e.value)))},z=(e,a)=>{E((t=>({...t,[a]:t[a].filter(((a,t)=>t!==e))})))};return console.log("add Class ",b),(0,g.jsx)(g.Fragment,{children:(0,g.jsxs)(i.A,{backText:"Classes",children:[(0,g.jsxs)(o.a,{children:[(0,g.jsx)(s.BR,{name:"event",label:"Class Name",options:k,onChange:R,data:b}),(0,g.jsx)(s.o4,{name:"isActive",data:b,onChange:R,extraClassName:"text-right"})]}),(0,g.jsxs)(o.Ay,{title:"When and Where",col:"12",children:[(0,g.jsxs)(o.a,{children:[(0,g.jsx)(s.BR,{name:"classMeet",label:"How often does class meet?",options:n.e6,onChange:R,data:b,col:"6"}),(0,g.jsx)(s.BR,{name:"classLocation",options:S,onChange:R,data:b,col:"6"}),(0,g.jsx)(s.wN,{name:"startDate",onChange:R,data:b}),(0,g.jsx)(s.wN,{name:"endDate",onChange:R,data:b,disabled:!(null!==b&&void 0!==b&&b.startDate)})]}),(0,g.jsx)(o.a,{extraClass:"justify-content-end",children:(0,g.jsx)(r.Ay,{label:"Add New Schedule",className:"mx-2 ",onClick:()=>{const e={days:[],startTime:"",timeFormat:"",duration:"",endTime:""};E((a=>({...a,schedule:[...a.schedule,e]})))},loading:I})}),null===b||void 0===b||null===(T=b.schedule)||void 0===T?void 0:T.map(((e,a)=>(0,g.jsx)("div",{children:(0,g.jsxs)(o.a,{extraClass:"align-items-center",children:[(0,g.jsx)(s.wN,{name:"startTime",customIndex:a,onChange:Z,data:e,fieldName:"schedule",timeOnly:!0,placeholder:"Select Time",hourFormat:"12"}),(0,g.jsx)(s.BR,{name:"duration",customIndex:a,options:_,onChange:Z,data:e,fieldName:"schedule",placeholder:"Add Duration"}),(0,g.jsx)(s.Rx,{name:"days",customIndex:a,onChange:Z,data:e,options:n.dl,fieldName:"schedule",col:4}),(0,g.jsx)(s.wN,{name:"endTime",customIndex:a,onChange:Z,data:e,fieldName:"schedule",timeOnly:!0,placeholder:"Select Time",hourFormat:"12",disabled:!0}),a>0&&(0,g.jsx)("i",{className:"pi pi-minus-circle mt-4",onClick:()=>z(a,"schedule")})]})},a)))]}),(0,g.jsxs)(o.Ay,{title:"Instructor",col:"12",children:[(0,g.jsxs)(o.a,{children:[(0,g.jsx)(s.BR,{name:"staff",options:W,onChange:R,data:b}),(0,g.jsx)(s.BR,{name:"payType",options:(()=>{var e,a;let t=null===N||void 0===N||null===(e=N.employeeClassData)||void 0===e?void 0:e.map((e=>({name:e.label,value:e.payType})));const l=new Set(null===t||void 0===t?void 0:t.map((e=>JSON.stringify(e))));return null===(a=Array.from(l))||void 0===a?void 0:a.map((e=>JSON.parse(e)))})(),onChange:R,data:b})]}),(0,g.jsx)(o.a,{extraClass:"justify-content-end",children:(0,g.jsx)(r.Ay,{label:"Add Assistant",className:"mx-2",onClick:()=>{const e={assistant:"",assistantPay:""};E((a=>({...a,instructor:[...a.instructor,e]})))},loading:I})}),null===b||void 0===b||null===(w=b.instructor)||void 0===w?void 0:w.map(((e,a)=>(0,g.jsx)("div",{children:(0,g.jsxs)(o.a,{extraClass:"align-items-center",children:[(0,g.jsx)(s.BR,{name:"assistant",customIndex:a,options:V(a),fieldName:"instructor",onChange:Z,data:e}),(0,g.jsx)(s.BR,{name:"assistantPay",customIndex:a,options:e.assistantPayOptions,fieldName:"instructor",onChange:Z,data:e}),a>0&&(0,g.jsx)("i",{className:"pi pi-minus-circle mt-4",onClick:()=>z(a,"instructor")})]})},a)))]}),(0,g.jsx)(o.Ay,{title:"Participants",col:"12",children:(0,g.jsxs)(o.a,{children:[(0,g.jsx)(s.Bt,{name:"totalCapacity",onChange:R,data:b}),(0,g.jsx)(s.Bt,{name:"waitlistPeople",label:"How many people can waitlist",onChange:R,data:b})]})}),(0,g.jsx)(o.Ay,{title:"Online Scheduling",col:"12",children:(0,g.jsxs)(o.a,{children:[(0,g.jsx)(s.ZD,{name:"clientSignupClass",label:"Allow clients to sign up for this class online",onChange:R,data:b,col:"12"}),(0,g.jsx)(s.Bt,{name:"onlineCapacity",label:"Online Capacity",onChange:R,data:b,col:"6"})]})}),(0,g.jsx)(o.Ay,{title:"Pricing",col:"12",children:(0,g.jsxs)(o.a,{children:[(0,g.jsx)(s.ZD,{name:"clientPaylater",label:"Allow clients to sign up now and pay later",onChange:R,data:b,col:"12"}),(0,g.jsx)(s.ZD,{name:"clientClassFree",label:"Clients can attend this class for free",onChange:R,data:b,col:"12"})]})}),(0,g.jsxs)(r.zp,{children:[(0,g.jsx)(r.Ay,{label:"Save",className:"mx-2",onClick:()=>{if((0,m.nV)(b,E)){let e=(0,m.Kk)(b.schedule);e.isValid||E((a=>({...a,schedule:e.data}))),e.isValid&&D(P?(0,y.fA)(P,b,B):(0,y.gR)(b,B))}},loading:I}),(0,g.jsx)(r.Ti,{label:"Cancel",onClick:()=>B.goBack()})]})]})})}}}]);
//# sourceMappingURL=895.3c55185c.chunk.js.map