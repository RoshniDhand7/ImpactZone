"use strict";(self.webpackChunkimpact_zone_frontend=self.webpackChunkimpact_zone_frontend||[]).push([[895],{3895:(a,e,t)=>{t.r(e),t.d(e,{default:()=>x});var l=t(5043),s=t(1326),n=t(7374),i=t(5050),o=t(5378),d=t(1688),c=t(9456),r=t(6038),u=t(7994),v=t(7275),p=t(4454),m=t(8085),y=t(1715),f=t(2114),h=t(346),C=t(579);const x=()=>{var a,e,t,x;const j=(0,c.wA)(),{id:g}=(0,d.g)(),{allEmployees:P,employeePayType:w}=(0,c.d4)((a=>a.employees)),[D,A]=(0,l.useState)({event:"",classMeet:"",classLocation:"",startDate:"",endDate:"",schedule:[{days:[],startTime:""}],instructor:[{assistant:null,assistantPay:""}],staff:"",payType:"",totalCapacity:null,waitlistPeople:null,clientSignupClass:!1,onlineCapacity:null,clientPaylater:!1,clientClassFree:!1});(0,l.useEffect)((()=>{j((0,v.Vs)()),j((0,p.kQ)()),j((0,y.Oc)())}),[j]);const{locationDropdown:T}=(0,c.d4)((a=>a.locations)),{allEventClassesDropDown:E}=(0,c.d4)((a=>a.event));let{allEventClasses:N}=(0,c.d4)((a=>a.event));N=null===(a=N)||void 0===a?void 0:a.find((a=>a._id===(null===D||void 0===D?void 0:D.event)));const b=(0,d.W6)();(0,l.useEffect)((()=>{null!==D&&void 0!==D&&D.event&&A((a=>{var e,t;return{...a,totalCapacity:null===(e=N)||void 0===e?void 0:e.defaultMaxAttendes,waitlistPeople:null===(t=N)||void 0===t?void 0:t.maximumWaitlist}}))}),[null===D||void 0===D?void 0:D.event,N]),(0,l.useEffect)((()=>{g&&j((0,f.h5)(g,(a=>{var e,t,l;if(j((0,y.Zh)(null===a||void 0===a?void 0:a.staff)),A({event:a.event,classMeet:a.classMeet,classLocation:a.classLocation,startDate:new Date(a.startDate),endDate:new Date(a.endDate),schedule:null===(e=a.schedule)||void 0===e?void 0:e.map((a=>({...a,startTime:(0,m.yQ)(a.startTime)}))),instructor:a.instructor,staff:a.staff,payType:a.pay,totalCapacity:a.totalCapacity?a.totalCapacity:null===(t=N)||void 0===t?void 0:t.defaultMaxAttendes,waitlistPeople:a.waitlistPeople?a.waitlistPeople:null===(l=N)||void 0===l?void 0:l.maximumWaitlist,clientSignupClass:a.clientSignupClass,onlineCapacity:a.onlineCapacity,clientPaylater:a.clientPaylater,clientClassFree:a.clientClassFree}),a.instructor&&a.instructor.length>0)for(const s of a.instructor)S(s.assistant)})))}),[g,j,P,N]);const S=async a=>{const e=P.find((e=>e._id===a));if(e){var t;const l=e.employeeClassData.map((a=>({name:a.label,value:a.payType}))).filter(((a,e,t)=>e===t.findIndex((e=>e.value===a.value)))),s=null===e||void 0===e||null===(t=e.employeeClassData)||void 0===t?void 0:t.find((a=>a.isDefaultPay));A((e=>({...e,instructor:e.instructor.map((e=>e.assistant===a?{...e,assistantPayOptions:l,assistantPay:s?s.payType:e.assistantPay}:e))})))}},k=(0,c.d4)((a=>{var e;return null===a||void 0===a||null===(e=a.loader)||void 0===e?void 0:e.isLoading})),_=a=>{let{name:e,value:t}=a;const l=(0,r.A)(e,t,D);A((a=>({...a,[e]:t,formErrors:l})))};console.log("allClasses>>",N),(0,l.useEffect)((()=>{null!==D&&void 0!==D&&D.event&&(j((0,p.gw)(null===D||void 0===D?void 0:D.event)),A((a=>({...a,staff:"",payType:"",instructor:[{assistant:null,assistantPay:""}]}))))}),[null===D||void 0===D?void 0:D.event]);const{allServicesEvents:B}=(0,c.d4)((a=>a.event)),O=B&&(null===B||void 0===B||null===(e=B.EventService)||void 0===e?void 0:e.map((a=>{var e;return null===(e=a.eventLevel)||void 0===e?void 0:e._id}))),R=P.filter((a=>a.employeeClassData.some((a=>null===O||void 0===O?void 0:O.includes(a.isClassLevel))))).map((a=>({name:a.firstName,value:a._id})));(0,l.useEffect)((()=>(null!==D&&void 0!==D&&D.staff&&j((0,y.Zh)(null===D||void 0===D?void 0:D.staff)),()=>{j({type:h.g.CHANGE_EMPLOYEES_PAY_TYPE,payload:[]})})),[null===D||void 0===D?void 0:D.staff,j]),(0,l.useEffect)((()=>{if(w){var a;let e=null===w||void 0===w||null===(a=w.employeeClassData)||void 0===a?void 0:a.find((a=>a.isDefaultPay));A((a=>({...a,payType:e?e.payType:null})))}}),[w,P]);const I=async a=>{let{name:e,value:t,customIndex:l,fieldName:s}=a;const n={...D};let i=n[s][l];i[e]=t,"assistant"===e&&(n[s][l]=i,A((()=>({...n}))),await j((0,y.Zh)(t)));const o=(0,r.A)(e,t,i);if(i.formErrors=o,n[s][l]=i,A((()=>({...n}))),"assistant"===e){const a=t,e=P.find((e=>e._id===a));if(e){var d;const a=e.employeeClassData.map((a=>({name:a.label,value:a.payType}))).filter(((a,e,t)=>e===t.findIndex((e=>e.value===a.value)))),t=null===e||void 0===e||null===(d=e.employeeClassData)||void 0===d?void 0:d.find((a=>a.isDefaultPay));A((e=>({...e,instructor:e.instructor.map(((e,s)=>s===l?{...e,assistantPayOptions:a,assistantPay:t?t.payType:null}:e))})))}}},L=a=>{var e;const t=null===(e=D.instructor.filter(((e,t)=>t!==a)))||void 0===e?void 0:e.flatMap((a=>a.assistant)),l=[D.staff,...t];return R.filter((a=>!l.includes(a.value)))},M=(a,e)=>{A((t=>({...t,[e]:t[e].filter(((e,t)=>t!==a))})))};return console.log("data,",D),(0,C.jsx)(C.Fragment,{children:(0,C.jsxs)(i.A,{backText:"Classes",children:[(0,C.jsx)(o.a,{children:(0,C.jsx)(s.BR,{name:"event",label:"Class Name",options:E,onChange:_,data:D})}),(0,C.jsxs)(o.Ay,{title:"When and Where",col:"12",children:[(0,C.jsxs)(o.a,{children:[(0,C.jsx)(s.BR,{name:"classMeet",label:"How often does class meet?",options:n.e6,onChange:_,data:D,col:"6"}),(0,C.jsx)(s.BR,{name:"classLocation",options:T,onChange:_,data:D,col:"6"}),(0,C.jsx)(s.wN,{name:"startDate",onChange:_,data:D}),(0,C.jsx)(s.wN,{name:"endDate",onChange:_,data:D})]}),(0,C.jsx)(o.a,{extraClass:"justify-content-end",children:(0,C.jsx)(u.Ay,{label:"Add New Schedule",className:"mx-2 ",onClick:()=>{const a={days:[],startTime:"",timeFormat:""};A((e=>({...e,schedule:[...e.schedule,a]})))},loading:k})}),null===D||void 0===D||null===(t=D.schedule)||void 0===t?void 0:t.map(((a,e)=>(0,C.jsx)("div",{children:(0,C.jsxs)(o.a,{extraClass:"align-items-center",children:[(0,C.jsx)(s.wN,{name:"startTime",customIndex:e,onChange:I,data:a,fieldName:"schedule",timeOnly:!0,placeholder:"Select Time",hourFormat:"12"}),(0,C.jsx)(s.Rx,{name:"days",customIndex:e,onChange:I,data:a,options:n.dl,fieldName:"schedule",col:4}),e>0&&(0,C.jsx)("i",{class:"pi pi-minus-circle mt-4",onClick:()=>M(e,"schedule")})]})},e)))]}),(0,C.jsxs)(o.Ay,{title:"Instructor",col:"12",children:[(0,C.jsxs)(o.a,{children:[(0,C.jsx)(s.BR,{name:"staff",options:R,onChange:_,data:D}),(0,C.jsx)(s.BR,{name:"payType",options:(()=>{var a,e;let t=null===w||void 0===w||null===(a=w.employeeClassData)||void 0===a?void 0:a.map((a=>({name:a.label,value:a.payType})));const l=new Set(null===t||void 0===t?void 0:t.map((a=>JSON.stringify(a))));return null===(e=Array.from(l))||void 0===e?void 0:e.map((a=>JSON.parse(a)))})(),onChange:_,data:D})]}),(0,C.jsx)(o.a,{extraClass:"justify-content-end",children:(0,C.jsx)(u.Ay,{label:"Add Assistant",className:"mx-2",onClick:()=>{const a={assistant:"",assistantPay:""};A((e=>({...e,instructor:[...e.instructor,a]})))},loading:k})}),null===D||void 0===D||null===(x=D.instructor)||void 0===x?void 0:x.map(((a,e)=>(0,C.jsx)("div",{children:(0,C.jsxs)(o.a,{extraClass:"align-items-center",children:[(0,C.jsx)(s.BR,{name:"assistant",customIndex:e,options:L(e),fieldName:"instructor",onChange:I,data:a}),(0,C.jsx)(s.BR,{name:"assistantPay",customIndex:e,options:a.assistantPayOptions,fieldName:"instructor",onChange:I,data:a}),e>0&&(0,C.jsx)("i",{className:"pi pi-minus-circle mt-4",onClick:()=>M(e,"instructor")})]})},e)))]}),(0,C.jsx)(o.Ay,{title:"Participants",col:"12",children:(0,C.jsxs)(o.a,{children:[(0,C.jsx)(s.Bt,{name:"totalCapacity",onChange:_,data:D}),(0,C.jsx)(s.Bt,{name:"waitlistPeople",label:"How many people can waitlist",onChange:_,data:D})]})}),(0,C.jsx)(o.Ay,{title:"Online Scheduling",col:"12",children:(0,C.jsxs)(o.a,{children:[(0,C.jsx)(s.ZD,{name:"clientSignupClass",label:"Allow clients to sign up for this class online",onChange:_,data:D,col:"12"}),(0,C.jsx)(s.Bt,{name:"onlineCapacity",label:"Online Capacity",onChange:_,data:D,col:"6"})]})}),(0,C.jsx)(o.Ay,{title:"Pricing",col:"12",children:(0,C.jsxs)(o.a,{children:[(0,C.jsx)(s.ZD,{name:"clientPaylater",label:"Allow clients to sign up now and pay later",onChange:_,data:D,col:"12"}),(0,C.jsx)(s.ZD,{name:"clientClassFree",label:"Clients can attend this class for free",onChange:_,data:D,col:"12"})]})}),(0,C.jsxs)(u.zp,{children:[(0,C.jsx)(u.Ay,{label:"Save",className:"mx-2",onClick:()=>{if((0,m.nV)(D,A)){let a=(0,m.Kk)(D.schedule);a.isValid||A((e=>({...e,schedule:a.data}))),a.isValid&&j(g?(0,f.fA)(g,D,b):(0,f.gR)(D,b))}},loading:k}),(0,C.jsx)(u.Ti,{label:"Cancel",onClick:()=>b.goBack()})]})]})})}}}]);
//# sourceMappingURL=895.588cea8c.chunk.js.map