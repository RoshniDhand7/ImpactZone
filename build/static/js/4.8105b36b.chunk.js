"use strict";(self.webpackChunkimpact_zone_frontend=self.webpackChunkimpact_zone_frontend||[]).push([[4],{6396:(e,n,t)=>{t.r(n),t.d(n,{default:()=>w});var l=t(9379),o=t(5043),r=t(9456),i=t(1688),s=t(5496),a=t.n(s),c=t(3141),d=t(6041),u=t.n(d),m=t(6411);const p=t.p+"static/media/signature.6dc772d12863b19d0557.png";var g=t(3549),v=t(7994),h=t(3167);const x=(e,n,t)=>{const l=((e,n)=>{const t=atob(e),l=new Array(t.length);for(let r=0;r<t.length;r++)l[r]=t.charCodeAt(r);const o=new Uint8Array(l);return new Blob([o],{type:n})})(e,n);return((e,n)=>new File([e],n,{type:e.type,lastModified:Date.now()}))(l,t)};var f=t(8702),b=t(3191),y=t(6178),j=t.n(y),C=t(579);function w(){const e=(0,i.W6)(),n=(0,o.useRef)(),t=(0,o.useRef)(),s=(0,r.wA)(),{subscriptionPlanId:d}=(0,i.g)(),[y,w]=(0,o.useState)(!1),[A,S]=(0,o.useState)(!1),[E,N]=(0,o.useState)(null),[P,R]=(0,o.useState)([]),[_,k]=(0,o.useState)({});function M(e,n){let t=0;return e.replace(new RegExp(n,"g"),(()=>(t+=1,'<img id="signature-'.concat(t,'" alt="signature-').concat(t,'" style="max-height: 100px; max-width: 300px" />'))))}(0,o.useEffect)((()=>{s((0,h.M5)(d,w,(e=>{k((0,l.A)((0,l.A)({},e),{},{htmlContent:M(null===e||void 0===e?void 0:e.htmlContent,"{{MEMBER_SIGNATURE}}")}));let n=function(e,n){const t=new RegExp(n,"g");return[...e.matchAll(t)].map((()=>({url:"",error:!1})))}(null===e||void 0===e?void 0:e.htmlContent,"{{MEMBER_SIGNATURE}}");null!==e&&void 0!==e&&e.signatures.length?R(null===e||void 0===e?void 0:e.signatures):R(n)})))}),[s]);const T=()=>{N(null)};(0,o.useEffect)((()=>{P.forEach(((e,n)=>{document.getElementById("signature-".concat(n+1)).src=(0,f.b)(null===e||void 0===e?void 0:e.url)}))}),[P]);const I=(0,c.useReactToPrint)({content:()=>n.current,documentTitle:"Visitor Pass",onAfterPrint:()=>console.log("Printed PDF successfully!")}),[B,D]=(0,o.useState)(!1);return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(g.Ay,{col:"12",title:"Subscription Agreement",children:(0,C.jsxs)(g.a,{children:[(0,C.jsx)(g.iL,{size:9,children:(0,C.jsx)("div",{className:"overflow-auto bg-white border-round-sm p-2 h-screen",children:(0,C.jsxs)("div",{ref:n,id:"agreement-template",className:"p-2",children:[(0,C.jsx)("div",{dangerouslySetInnerHTML:{__html:null===_||void 0===_?void 0:_.htmlContent}}),(0,C.jsx)("style",{dangerouslySetInnerHTML:{__html:null===_||void 0===_?void 0:_.cssContent}})]})})}),(0,C.jsxs)(g.iL,{size:3,children:[(0,C.jsxs)(v.zp,{position:"center",children:[!(null!==_&&void 0!==_&&_.isSigned)&&(0,C.jsx)(v.Ay,{label:"Confirm",onClick:()=>{if(null!==_&&void 0!==_&&_.isSigned)return;let n=!0,t=P.map((e=>e.url?e:(n=!1,(0,l.A)((0,l.A)({},e),{},{error:!0}))));n?s((0,h.RB)(d,_,P,D,(()=>{e.push("/plans")}))):R(t)},loading:B}),(0,C.jsx)(v.Ay,{label:"Download",className:"mx-2",icon:"pi pi-download",loading:y,onClick:async()=>{let{subscription:e}=_,{member:n,company:t}=e;w(!0);const l=document.getElementById("agreement-template"),o={filename:"".concat(null===n||void 0===n?void 0:n.firstName,"-").concat(null===n||void 0===n?void 0:n.lastName,"-").concat(null===t||void 0===t?void 0:t.companyName,"(").concat(j()().format("ll"),").pdf"),jsPDF:{unit:"in",format:"a4",orientation:"portrait"},html2canvas:{scale:2}},r=document.createElement("div");r.appendChild(l.cloneNode(!0)),document.body.appendChild(r),await new Promise((e=>{u()(r,o,(()=>{document.body.removeChild(r),w(!1),e()}))}))}}),(0,C.jsx)(v.Ay,{label:"Print",className:"bg-yellow-300",onClick:I,icon:"pi pi-print"})]}),(0,C.jsx)("div",{style:{pointerEvents:null!==_&&void 0!==_&&_.isSigned?"none":"auto"},children:null===P||void 0===P?void 0:P.map(((e,n)=>(0,C.jsxs)("div",{className:"signature-box border-round-lg p-2 my-1 ".concat(null!==e&&void 0!==e&&e.error?"border-1 border-red-200":""),children:[(0,C.jsxs)("button",{className:"cursor-pointer",onClick:()=>(e=>{N(e+1)})(n),children:["Sign ",n+1]}),null!==e&&void 0!==e&&e.url?(0,C.jsx)("img",{style:{height:"100px"},src:(0,f.b)(null===e||void 0===e?void 0:e.url),alt:"signature-".concat(n+1)}):(0,C.jsxs)("p",{className:"",style:{height:"100px"},children:["Your Signature Here...",(0,C.jsx)("img",{className:"border-round-lg",style:{maxHeight:"80px"},src:p,alt:"signature-".concat(n+1)})]})]},n)))})]})]})}),(0,C.jsxs)(m.A,{title:"Signature ".concat(E||""),visible:E,onCancel:T,width:"80vh",onClear:()=>{t.current.clear()},onSave:()=>{if(t.current){let e=t.current.isEmpty(),n="";if(!e){let e=t.current.getTrimmedCanvas().toDataURL("image/png");e=e.split(",")[1];const l="image/png",o="signature_".concat(E,".png");n=x(e,l,o)}let l=[...P];A?l=l.map((()=>({url:n,error:!1}))):(l[E-1].url=n,l[E-1].error=!1),R(l),T()}},children:[(0,C.jsx)("div",{className:"border-round-sm border-1 surface-border ",children:(0,C.jsx)(a(),{canvasProps:{className:"sigPad"},ref:t})}),(0,C.jsx)(b.ZD,{label:"Copy To All",value:A,onChange:e=>S(e.value)})]})]})}}}]);
//# sourceMappingURL=4.8105b36b.chunk.js.map